<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô (Debug)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; text-align: center; padding: 1rem; }
    select, button, video, img { margin-top: 1rem; display: block; width: 100%; max-width: 300px; margin-left: auto; margin-right: auto; }
    #preview { margin-top: 1rem; }
  </style>
</head>
<body>
  <h2>‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤/‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô (‡πÇ‡∏´‡∏°‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á)</h2>
  <select id="employee">
    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</option>
    <option value="‡∏ô‡∏±‡∏ó">‡∏ô‡∏±‡∏ó</option>
    <option value="‡∏ô‡∏±‡∏ï‡∏ï‡∏µ‡πâ">‡∏ô‡∏±‡∏ï‡∏ï‡∏µ‡πâ</option>
    <option value="Yoko">Yoko</option>
  </select>

  <button onclick="openCamera()">üì∏ ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ</button>
  <video id="video" autoplay playsinline style="display:none;"></video>
  <button onclick="capture()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ</button>
  <canvas id="canvas" style="display:none;"></canvas>
  <img id="preview" src="" alt="Preview" />

  <button onclick="submitTime('‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô')">‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô</button>
  <button onclick="submitTime('‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô')">‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô</button>

  <script>
    let imageData = "";
    let video = document.getElementById("video");
    let canvas = document.getElementById("canvas");
    let preview = document.getElementById("preview");
    let stream = null;

    function openCamera() {
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        alert("‚ùå ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á");
        return;
      }

      navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } })
        .then(s => {
          stream = s;
          video.srcObject = stream;
          video.style.display = "block";
          console.log("‚úÖ ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß");
        })
        .catch(err => {
          alert("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ: " + err.message);
          console.error("Camera error:", err);
        });
    }

    function capture() {
      if (!stream) return alert("‚ö†Ô∏è ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î");
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      canvas.getContext("2d").drawImage(video, 0, 0);
      imageData = canvas.toDataURL("image/jpeg", 0.85);
      preview.src = imageData;
      preview.style.display = "block";
      console.log("üì∏ ‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡πÅ‡∏•‡πâ‡∏ß");
    }

    function submitTime(action) {
      const name = document.getElementById("employee").value;
      if (!name) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô");
      if (!imageData) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");

      navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;

        fetch("https://script.google.com/macros/s/AKfycbyKzPezH4cIXus9tW0LsGp5vy5rDnY6EEmSv7hxmWthwiorqNTjTz4VSSnU9WB-3ofCGA/exec", {
          method: "POST",
          body: JSON.stringify({ name, action, lat, lng, image: imageData }),
          headers: { "Content-Type": "application/json" }
        })
        .then(res => res.text())
        .then(txt => alert("‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"))
        .catch(err => alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message));
      }, err => {
        alert("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏î‡πâ: " + err.message);
      });
    }
  </script>
</body>
</html>
