<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>ระบบลงเวลาเข้าออกงาน</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; text-align: center; padding: 1rem; }
    select, button { margin-top: 1rem; display: block; width: 100%; max-width: 300px; margin-left: auto; margin-right: auto; }
    .note { color: red; font-weight: bold; margin-bottom: 1rem; }
  </style>
</head>
<body>
  <h2>ลงเวลาเข้า/ออกงาน</h2>
  <div class="note">❗ กรุณาเปิดตำแหน่ง (GPS) และอนุญาตเมื่อมีการร้องขอ</div>

  <select id="employee">
    <option value="">เลือกชื่อพนักงาน</option>
    <option value="นัท">นัท</option>
    <option value="นัตตี้">นัตตี้</option>
    <option value="Yoko">Yoko</option>
    <option value="น้ำ">น้ำ</option>
    <option value="อ้วน">อ้วน</option>
    <option value="โจช่าง">โจช่าง</option>
    <option value="ลุงปอ">ลุงปอ</option>
    <option value="ลิน">ลิน</option>
    <option value="วิน ชาย">วิน ชาย</option>
    <option value="ซัน">ซัน</option>
    <option value="นารี">นารี</option>
    <option value="เชอรี่">เชอรี่</option>
    <option value="ทานุ">ทานุ</option>
    <option value="เมย์ คนใหม่">เมย์ คนใหม่</option>
    <option value="วิน หญิง">วิน หญิง</option>
    <option value="เมียะ">เมียะ</option>
    <option value="เมย์">เมย์</option>
    <option value="ธรรมรงค์">ธรรมรงค์</option>
    <option value="ดู รปภ">ดู รปภ</option>
    <option value="วดี">วดี</option>
    <option value="คิง">คิง</option>
    <option value="ตุ้ย">ตุ้ย</option>
    <option value="วาวา">วาวา</option>
    <option value="โซ">โซ</option>
  </select>

  <button onclick="submitTime('เข้างาน')">เข้างาน</button>
  <button onclick="submitTime('ออกงาน')">ออกงาน</button>

  <script>
    function submitTime(action) {
      const name = document.getElementById("employee").value;
      if (!name) return alert("กรุณาเลือกชื่อพนักงาน");

      navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;

        const officeLat = 13.738127;
        const officeLng = 100.575133;
        const distance = getDistance(lat, lng, officeLat, officeLng);

        if (distance > 200) return alert("❌ คุณอยู่นอกพื้นที่สำนักงาน (ระยะ: " + Math.round(distance) + " ม.)");

        fetch("https://script.google.com/macros/s/AKfycbyKzPezH4cIXus9tW0LsGp5vy5rDnY6EEmSv7hxmWthwiorqNTjTz4VSSnU9WB-3ofCGA/exec", {
          method: "POST",
          body: JSON.stringify({ name, action, lat, lng }),
          headers: { "Content-Type": "application/json" }
        })
        .then(res => res.text())
        .then(txt => alert("✅ บันทึกสำเร็จ: " + txt))
        .catch(err => alert("❌ เกิดข้อผิดพลาด: " + err.message));
      }, err => {
        alert("❌ ไม่สามารถดึงตำแหน่งที่ตั้งได้: " + err.message);
      });
    }

    function getDistance(lat1, lon1, lat2, lon2) {
      const R = 6371e3;
      const toRad = x => x * Math.PI / 180;
      const dLat = toRad(lat2 - lat1);
      const dLon = toRad(lon2 - lon1);
      const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon/2)**2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }
  </script>
</body>
</html>
