<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; text-align: center; padding: 1rem; }
    select, button, video, img { margin-top: 1rem; display: block; width: 100%; max-width: 300px; margin-left: auto; margin-right: auto; }
    #preview { margin-top: 1rem; }
  </style>
</head>
<body>
  <h2>‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤/‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô</h2>
  <select id="employee">
    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</option>
    <option value="‡∏ô‡∏±‡∏ó">‡∏ô‡∏±‡∏ó</option>
    <option value="‡∏ô‡∏±‡∏ï‡∏ï‡∏µ‡πâ">‡∏ô‡∏±‡∏ï‡∏ï‡∏µ‡πâ</option>
    <option value="Yoko">Yoko</option>
    <option value="‡∏ô‡πâ‡∏≥">‡∏ô‡πâ‡∏≥</option>
    <option value="‡∏≠‡πâ‡∏ß‡∏ô">‡∏≠‡πâ‡∏ß‡∏ô</option>
    <option value="‡πÇ‡∏à‡∏ä‡πà‡∏≤‡∏á">‡πÇ‡∏à‡∏ä‡πà‡∏≤‡∏á</option>
    <option value="‡∏•‡∏∏‡∏á‡∏õ‡∏≠">‡∏•‡∏∏‡∏á‡∏õ‡∏≠</option>
    <option value="‡∏•‡∏¥‡∏ô">‡∏•‡∏¥‡∏ô</option>
    <option value="‡∏ß‡∏¥‡∏ô ‡∏ä‡∏≤‡∏¢">‡∏ß‡∏¥‡∏ô ‡∏ä‡∏≤‡∏¢</option>
    <option value="‡∏ã‡∏±‡∏ô">‡∏ã‡∏±‡∏ô</option>
    <option value="‡∏ô‡∏≤‡∏£‡∏µ">‡∏ô‡∏≤‡∏£‡∏µ</option>
    <option value="‡πÄ‡∏ä‡∏≠‡∏£‡∏µ‡πà">‡πÄ‡∏ä‡∏≠‡∏£‡∏µ‡πà</option>
    <option value="‡∏ó‡∏≤‡∏ô‡∏∏">‡∏ó‡∏≤‡∏ô‡∏∏</option>
    <option value="‡πÄ‡∏°‡∏¢‡πå ‡∏Ñ‡∏ô‡πÉ‡∏´‡∏°‡πà">‡πÄ‡∏°‡∏¢‡πå ‡∏Ñ‡∏ô‡πÉ‡∏´‡∏°‡πà</option>
    <option value="‡∏ß‡∏¥‡∏ô ‡∏´‡∏ç‡∏¥‡∏á">‡∏ß‡∏¥‡∏ô ‡∏´‡∏ç‡∏¥‡∏á</option>
    <option value="‡πÄ‡∏°‡∏µ‡∏¢‡∏∞">‡πÄ‡∏°‡∏µ‡∏¢‡∏∞</option>
    <option value="‡πÄ‡∏°‡∏¢‡πå">‡πÄ‡∏°‡∏¢‡πå</option>
    <option value="‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏á‡∏Ñ‡πå">‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏á‡∏Ñ‡πå</option>
    <option value="‡∏î‡∏π ‡∏£‡∏õ‡∏†">‡∏î‡∏π ‡∏£‡∏õ‡∏†</option>
    <option value="‡∏ß‡∏î‡∏µ">‡∏ß‡∏î‡∏µ</option>
    <option value="‡∏Ñ‡∏¥‡∏á">‡∏Ñ‡∏¥‡∏á</option>
    <option value="‡∏ï‡∏∏‡πâ‡∏¢">‡∏ï‡∏∏‡πâ‡∏¢</option>
    <option value="‡∏ß‡∏≤‡∏ß‡∏≤">‡∏ß‡∏≤‡∏ß‡∏≤</option>
    <option value="‡πÇ‡∏ã">‡πÇ‡∏ã</option>
  </select>

  <button onclick="openCamera()">üì∏ ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ</button>
  <video id="video" autoplay playsinline style="display:none;"></video>
  <button onclick="capture()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ</button>
  <canvas id="canvas" style="display:none;"></canvas>
  <img id="preview" src="" alt="Preview" />

  <button onclick="submitTime('‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô')">‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô</button>
  <button onclick="submitTime('‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô')">‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô</button>

  <script>
    let imageData = "";
    let video = document.getElementById("video");
    let canvas = document.getElementById("canvas");
    let preview = document.getElementById("preview");
    let stream = null;

    function openCamera() {
      navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } })
        .then(s => {
          stream = s;
          video.srcObject = stream;
          video.style.display = "block";
        })
        .catch(err => alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ: " + err.message));
    }

    function capture() {
      if (!stream) return alert("‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î");
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      canvas.getContext("2d").drawImage(video, 0, 0);
      imageData = canvas.toDataURL("image/jpeg", 0.85);
      preview.src = imageData;
      preview.style.display = "block";
    }

    function submitTime(action) {
      const name = document.getElementById("employee").value;
      if (!name) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô");
      if (!imageData) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");

      navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;

        const officeLat = 13.738127102794989;
        const officeLng = 100.57513252231085;
        const distance = getDistance(lat, lng, officeLat, officeLng);

        if (distance > 200) return alert("‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô");

        fetch("https://script.google.com/macros/s/AKfycbyKzPezH4cIXus9tW0LsGp5vy5rDnY6EEmSv7hxmWthwiorqNTjTz4VSSnU9WB-3ofCGA/exec, {
          method: "POST",
          body: JSON.stringify({ name, action, lat, lng, image: imageData }),
          headers: { "Content-Type": "application/json" }
        })
        .then(res => res.text())
        .then(txt => alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"))
        .catch(err => alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message));
      }, err => {
        alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏î‡πâ: " + err.message);
      });
    }

    function getDistance(lat1, lon1, lat2, lon2) {
      const R = 6371e3;
      const toRad = x => x * Math.PI / 180;
      const dLat = toRad(lat2 - lat1);
      const dLon = toRad(lon2 - lon1);
      const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon/2)**2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }
  </script>
</body>
</html>
